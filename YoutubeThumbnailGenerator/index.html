<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+SC:400,900|Noto+Sans+TC:400,900" rel="stylesheet">
    <style>
        html,
        body {
            position: relative;
            width: 1280px;
            height: 720px;
            overflow: hidden;
            background-color: black;
            margin: 0px;
            font-family: "Noto Sans TC", "Noto Sans SC", "微軟正黑體";
        }

        body {
            background-image: url("./bg.png");
            background-size: contain;
            background-position: center;
            /* transform: scale(0.2); */
        }


        .content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
            height: 600px;
            padding: 0px 20px;
            box-sizing: border-box;
        }

        .mainvisual {
            position: absolute;
            right: 0;
            bottom: 0;
            transform: translate(20%, 20%);
            width: 70%;
        }

        .title {

            position: relative;
            font-size: 7em;
            line-height: 1.2;
            font-style: italic;
            top: 0px;
            margin: 0px auto;
            word-wrap: break-word;
            margin-bottom: 20px;
        }

        .room {
            position: absolute;
            top: -80px;
            left: -80px;
            font-size: 60em;
            opacity: 0.2;
            color: rgb(100, 52, 37);
            line-height: 1;
            margin: 0;
            font-style: italic;
            z-index: 1;
        }

        .names {
            margin: 0px;
            font-size: 4em;
            position: relative;
            text-align: right;
        }

        .name2 {
            font-size: 0.8em;
            font-weight: 400;
        }

        .speaker {
            display: inline-block;
            margin: 0px 10px;
        }

        .names::before {
            display: inline-block;
            content: ' ';
            border-bottom: 3px solid #A88C6F;
            width: 150px;
            height: 0px;
            margin: 20px;
        }

        .type {
            position: absolute;
            left: 0;
            bottom: 0;
            display: inline;
            padding: 4px 16px;
            font-size: 5em;
            margin: 0px;
            color: white;
            z-index: 2;
            transform: translate(40px, 0);
        }

        .type::before {
            left: 0px;
            top: 0px;
            content: '';
            display: block;
            position: absolute;
            background-color: #A88C6F;
            width: 100%;
            height: 100%;
            z-index: -1;
            transform: translate(-40px, 0);

        }


        .type::after {
            right: 0px;
            content: '';
            position: absolute;
            border-left: solid 80px #A88C6F;
            border-top: solid 40px transparent;
            height: 100%;
            top: 0px;
            transform: translate(100%, 0) translate(-40px, 0);
            z-index: -1;
        }

        .role {
            display: inline-block;
            font-size: .6em;
            background-color: black;
            color: orange;
            padding: 10px;
            text-align: center;
            margin: 10px;
            border-radius: 500px;

        }

        .images {
            position: absolute;
            z-index: 0;
        }

        .images img {
            width: 33%;
            border-radius: 999px;
            opacity: .4;
            transform: scale(2);
        }

        .speaker img {
            position: relative;
            height: 100px;
            border-radius: 8px;
            margin: 0px 10px;
            z-index: 2;
            top: 0px;
            transform: translate(0, 25%) scale(1.1);
        }

        .bg {
            position: absolute;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
        }
    </style>
</head>

<body>
    <div class="bg"></div>
    <div class="content">
        <div class="images"></div>
        <h1 class="room">R0</h1>
        <h1 class="title">甜食與他的產地甜食與他的產地甜食與他的產地</h1>
        <h2 class="names"></h2>
        <p class="type"></p>
    </div>

</body>
<script>


    var videoimg = {
        1: 'R0_open',
        2: 'R0_key1',
        3: 'R0_key2',
        4: null, // 'R0_query',
        5: null, // 'lunch',
        6: null, // 'R0_algorithm',
        7: null, // 'break',
        8: 'R0_p',
        9: 'R0_wiki',
        10: 'R0_ai',
        11: 'R0_news',
        12: 'R0_school',
        13: 'R0_lightning',
        14: null, // 'R0_close',
        15: null, // 'R1_new',
        16: null, // 'R1_google',
        17: 'R1_484',
        18: 'R1_tool',
        19: 'R1_donate',
        20: 'R1_point',
        21: 'R1_hack',
        22: 'R1_village',
        23: 'R2_1min',
        24: 'R2_micro',
        25: 'R2_php',
        26: 'R2_pe',
        27: 'R2_vr',
        28: null, // 'R2_net',
        29: 'R2_cloud',
        30: 'R2_linux',
        31: 'R3_rex',
        32: 'R3_functional',
        33: null, // 'R3_room',
        34: null, // 'R3_game',
        35: null, // 'R3_win',
        36: 'R2_104',
        37: null, // 點心
        38: null, // break
        39: null, // break
        40: null, // 'R3_iot'
    }



    /**
     * 從時間字串產生 "小時分鐘" 格式的四位數字串
     * @param {string} time 代表時間的字串
     */
    function timecode(time) {
        var t = new Date(time)
        return t.getHours().toString().padStart(2, 0) + t.getMinutes().toString().padStart(2, 0)
    }

    var noWrapList = [
        '商管', '演算法', '食息日常', '初學路上',
        '什麼', '是大斗內', '點數系統', '一起', '作為',
        '搜尋引擎', '尋找光明', '在與未來', '與決定', '开箱即用', '過得還好嗎',
        '不想停的算計'
    ]

    var xhr = new XMLHttpRequest()
    var n = new URL(location.href, location.origin).searchParams.get('n')
    console.log(n)
    xhr.open('get', 'https://sitcon.org/2019/static/json/agenda.json')
    xhr.onload = function () {

        var agenda = JSON.parse(xhr.response)
        noWrapList.map(word => {
            agenda[n].zh.title =
                agenda[n].zh.title.replace(
                    new RegExp(word, 'g'),
                    [...word].join('\uFEFF')
                )
        })
        agenda[n].zh.title = agenda[n].zh.title.replace("！", "!")
        // agenda[n].zh.title = agenda[n].zh.title.replace(/\s/, "")
        agenda[n].zh.title = agenda[n].zh.title.replace(/（/, "(")
        agenda[n].zh.title = agenda[n].zh.title.replace(/）/, ")")
        agenda[n].zh.title = agenda[n].zh.title.replace(/，/, ",")
        agenda[n].zh.title = agenda[n].zh.title.replace(/？/, "?")

        document.querySelector('.title').textContent = agenda[n].zh.title

        document.querySelector('.room').textContent = agenda[n].room
        document.querySelector('.type').textContent = agenda[n].type


        var images = 0

        agenda[n].speakers.map(speaker => {
            images++
            var role = ""
            var name = speaker.zh.name
            var name2 = ""
            var rolematch = name.match(/^(.+)\s*-\s*(.+)$/)
            if (rolematch) {
                role = rolematch[1]
                name = rolematch[2]
            }

            var namematch = name.match(/^(.+)\/(.+)$/)
            if (namematch == null)
                namematch = name.match(/^(.+)\((.+)\)$/)
            if (namematch) {
                name = namematch[1]
                name2 = namematch[2]
            }
            var all = document.createElement('span')
            var rspan = document.createElement('span')
            var nspan = document.createElement('span')
            var n2span = document.createElement('span')
            rspan.classList.add('role')
            nspan.classList.add('name')
            n2span.classList.add('name2')
            all.classList.add('speaker')
            rspan.textContent = role
            nspan.textContent = name
            if (name2.trim().length > 0)
                n2span.textContent = '/' + name2
            if (role.trim().length > 0)
                all.append(rspan)


            var img = document.createElement('img')
            img.src = speaker.avatar
            all.append(img)
            all.append(nspan)
            all.append(n2span)
            img.onload = function () {
                images--
                if (images == 0) done()
            }

            document.querySelector('.names').append(all)
        }).join(', ')

        var model = agenda[n]

        var outputName = model.room + "_"
            + timecode(model.start) + "_"
            + timecode(model.end) + "_"
            + model.zh.title + "_" + model.speakers.filter(x => x.zh).map(x => x.zh.name).join('_')
        outputName = outputName.replace(/[<>#%\{\}\|\\\^~\[\]`;\?？:@=&\/]/g, '-')
        document.title = outputName
        addEventListener('keydown', function (e) {
            if (e.key == 'ArrowLeft') location.href = './index.html?n=' + (n - 1)
            if (e.key == 'ArrowRight') location.href = './index.html?n=' + (+n + 1)
        })


        if (videoimg[n] != null) {
            images++
            var vidimg = document.createElement('img')
            vidimg.src = './videoimg/' + videoimg[n] + '.jpg'
            vidimg.onload = function () {
                images--
                if (images == 0) done()
            }
            document.querySelector('.bg').style.backgroundImage = 'url("' + vidimg.src + '")'
        }



        if (images == 0) done()

    }
    xhr.send()
</script>

</html>